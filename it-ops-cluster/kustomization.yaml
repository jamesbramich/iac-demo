#------------------------------------------------------------------------------
#
# Filename: kustomization.yaml
#
# Description: Provides resources for it-ops-1 cluster.
#
# Usage: kubectl apply -k <PATH-TO-FOLDER-CONTAINING-THIS-FILE>
#
# Author: James Bramich (james@nofrixion.com)
#
# History:
#   9 May      2024    James Bramich  Created, Northdown, Tasmania, Australia.
#-----------------------------------------------------------------------------
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: it-ops-cluster

resources:
  - it-ops-cluster.yaml
  - helm-cert-manager.yaml
  - helm-metrics-server.yaml

replacements:
- source:
    kind: Cluster
    fieldPath: spec.parameters.id
  targets:
  - select:
      group: helm.crossplane.io
      kind: Release
    fieldPaths:
    - spec.providerConfigRef.name
    options:
      delimiter: "-"
      index: 0
  - select:
      group: kubernetes.crossplane.io
      kind: Object
    fieldPaths:
    - spec.providerConfigRef.name
    - metadata.name
    options:
      delimiter: "-"
      index: 0
